-- Test pipeline for UDFs

SOURCE sample_data TYPE CSV PARAMS {
  "path": "data/sample.csv",
  "has_header": true
};

LOAD sample_data INTO raw_data;

-- Use scalar UDF to capitalize name
CREATE TABLE processed_data AS
SELECT 
  id,
  PYTHON_FUNC("python_udfs.sample_udfs.capitalize_words", name) AS formatted_name,
  price,
  quantity,
  PYTHON_FUNC("python_udfs.sample_udfs.add_tax", price, 0.08) AS price_with_tax
FROM raw_data;

-- Use table UDF to add metrics
CREATE TABLE sales_metrics AS
SELECT * 
FROM (
  SELECT * FROM PYTHON_FUNC("python_udfs.sample_udfs.add_metrics", processed_data)
);

-- Export results
EXPORT
  SELECT * FROM sales_metrics
TO "output/sales_with_metrics.csv"
TYPE CSV
OPTIONS { "header": true }; 