-- Secure Shopify Connection Test using Environment Variables
-- Set: export SHOPIFY_STORE="mystore.myshopify.com"
-- Set: export SHOPIFY_TOKEN="shpat_your_token_here"

SOURCE shopify_store TYPE SHOPIFY PARAMS {
    "shop_domain": "${SHOPIFY_STORE}",
    "access_token": "${SHOPIFY_TOKEN}",
    "sync_mode": "full_refresh"
};

-- Test different data objects
LOAD orders FROM shopify_store OBJECT "orders" LIMIT 3;
LOAD customers FROM shopify_store OBJECT "customers" LIMIT 3;
LOAD products FROM shopify_store OBJECT "products" LIMIT 3;

-- Quick connection validation
CREATE TABLE connection_status AS
SELECT 
    'orders' as data_type,
    COUNT(*) as records_found
FROM orders
UNION ALL
SELECT 
    'customers' as data_type,
    COUNT(*) as records_found
FROM customers
UNION ALL
SELECT 
    'products' as data_type,
    COUNT(*) as records_found
FROM products;

-- Export connection status
EXPORT SELECT * FROM connection_status 
TO "output/connection_status.csv" 
TYPE CSV OPTIONS { "header": true };

-- Export sample data for inspection
EXPORT SELECT * FROM orders 
TO "output/sample_orders.csv" 
TYPE CSV OPTIONS { "header": true };

EXPORT SELECT * FROM customers 
TO "output/sample_customers.csv" 
TYPE CSV OPTIONS { "header": true };

EXPORT SELECT * FROM products 
TO "output/sample_products.csv" 
TYPE CSV OPTIONS { "header": true }; 